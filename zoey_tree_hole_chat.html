<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Zoey's Tree Hole</title>
  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
  <style>
    body { font-family: Arial; max-width: 480px; margin: auto; padding: 20px; }
    #login, #chat { display: none; }
    #messages { border: 1px solid #ccc; padding: 10px; height: 320px; overflow-y: auto; }
    .msg { margin: 6px 0; }
  </style>
</head>
<body>
<h2>Zoey's Tree Hole</h2>

<!-- 密码登录界面 -->
<div id="login">
  <p>请输入密码进入聊天室：</p>
  <input id="pwd" type="password" style="width:100%; padding:8px;" placeholder="输入密码...">
  <button id="enterBtn" style="margin-top:10px; width:100%; padding:8px;">进入</button>
</div>

<!-- 聊天界面 -->
<div id="chat">
  <div id="messages"></div>

  <input id="name" placeholder="你的昵称" style="width:100%; margin-top:10px; padding:8px;">
  <textarea id="text" placeholder="输入消息..." style="width:100%; height:60px; margin-top:10px; padding:8px;"></textarea>
  <button id="sendBtn" style="width:100%; margin-top:10px; padding:8px;">发送</button>
</div>

<script>
// ====== 密码验证 ======
const correctPwd = "zoey1116";
const loginDiv = document.getElementById('login');
const chatDiv = document.getElementById('chat');
loginDiv.style.display = 'block';

document.getElementById('enterBtn').onclick = () => {
  if (document.getElementById('pwd').value === correctPwd) {
    loginDiv.style.display = 'none';
    chatDiv.style.display = 'block';
  } else {
    alert('密码错误！');
  }
};

// ====== GUN 实时聊天（无需服务器）======
const gun = Gun();
const room = gun.get('zoey-tree-hole');
const messagesDiv = document.getElementById('messages');

function addMessage(name, text) {
  const div = document.createElement('div');
  div.className = 'msg';
  div.textContent = `${name}: ${text}`;
  messagesDiv.appendChild(div);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// 监听新消息
room.map().on(data => {
  if (!data) return;
  addMessage(data.name, data.text);
});

// 发送消息
function send() {
  const name = document.getElementById('name').value.trim();
  const text = document.getElementById('text').value.trim();
  if (!name || !text) return;
  room.set({ name, text, t: Date.now() });
  document.getElementById('text').value = '';
}

document.getElementById('sendBtn').onclick = send;
</script>

</body>
</html>